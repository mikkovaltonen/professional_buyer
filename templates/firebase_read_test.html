<!DOCTYPE html>
<html>
<head>
    <title>Firebase Read Test</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase.js"></script>
</head>
<body>
    <h1>Firebase Read Test</h1>
    <div id="status">Testing...</div>
    <div id="results"></div>
    
    <script>
        // Käytä uutta Firebase-projektia (.env:stä)
        const firebaseConfig = {
            apiKey: "{{ firebase_config.FIREBASE_API_KEY }}",
            authDomain: "{{ firebase_config.FIREBASE_AUTH_DOMAIN }}",
            projectId: "{{ firebase_config.FIREBASE_PROJECT_ID }}",
            storageBucket: "{{ firebase_config.FIREBASE_STORAGE_BUCKET }}",
            messagingSenderId: "{{ firebase_config.FIREBASE_MESSAGING_SENDER_ID }}",
            appId: "{{ firebase_config.FIREBASE_APP_ID }}"
        };

        // Alusta Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        async function testFirebaseRead() {
            const statusDiv = document.getElementById('status');
            const resultsDiv = document.getElementById('results');
            
            try {
                statusDiv.innerHTML = 'Kirjaudutaan sisään...';
                
                // Kirjaudu sisään sähköpostilla ja salasanalla
                const userCredential = await auth.signInWithEmailAndPassword(
                    'mikko.j.valtonen@gmail.com', 
                    'Toukokuu2017'
                );
                
                statusDiv.innerHTML = 'Kirjautuminen onnistui! Luetaan agent_instructions...';
                
                // Lue agent_instructions collection
                const querySnapshot = await db.collection('agent_instructions').get();
                
                let results = '<h2>Agent Instructions Data:</h2>';
                
                if (querySnapshot.empty) {
                    results += '<p>Collection on tyhjä</p>';
                } else {
                    querySnapshot.forEach((doc) => {
                        const data = doc.data();
                        results += `
                            <div style="border: 1px solid #ccc; margin: 10px; padding: 10px;">
                                <h3>Document ID: ${doc.id}</h3>
                                <p><strong>Agent Name:</strong> ${data.agent_name || 'N/A'}</p>
                                <p><strong>Tallentaja:</strong> ${data.tallentajan_nimi || 'N/A'}</p>
                                <p><strong>Tallennus päivä:</strong> ${data.tallennus_paiva || 'N/A'}</p>
                                <p><strong>Version:</strong> ${data.version || 'N/A'}</p>
                                <p><strong>Instructions:</strong> ${data.instructions || 'N/A'}</p>
                                <p><strong>Evaluointi:</strong> ${data.evaluointi || 'N/A'}</p>
                                <p><strong>Trace ID:</strong> ${data.trace_id || 'N/A'}</p>
                            </div>
                        `;
                    });
                }
                
                statusDiv.innerHTML = 'Lukeminen onnistui!';
                resultsDiv.innerHTML = results;
                
            } catch (error) {
                statusDiv.innerHTML = `Virhe: ${error.message}`;
                console.error('Firebase error:', error);
            }
        }
        
        // Käynnistä testi kun sivu latautuu
        testFirebaseRead();
    </script>
</body>
</html>